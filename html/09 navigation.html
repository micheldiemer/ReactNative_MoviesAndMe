<h1 id="naviguer-entre-les-vues-les-activités">Naviguer entre les vues
(les activités)</h1>
<p>Voir la documentation de <a
href="https://reactnavigation.org/docs/getting-started/">React
Navigation</a><br> Plusieurs classes/objets permettent de gérer la
navigation :</p>
<ul>
<li><em>StackNavigator</em> : les vues sont empilées les unes sur les
autres et on choisit quelle vue on affiche</li>
<li><em>TabNavigator</em> : permet de créer une barre d’onglets</li>
<li><em>DrawerNavigator</em> : permet de créer un menu à gauche qui est
refermable et une vue à droite</li>
<li><em>NavigatorIOS</em> spécifique à iOS</li>
</ul>
<p>Installer react-navigation</br></p>
<ul>
<li><code>expo install react-navigation
react-navigation-stack</code></li>
<li><code>expo install react-native-gesture-handler
react-native-safe-area-context react-native-reanimated</code></li>
</ul>
<h2 id="créez-un-stacknavigator">Créez un StackNavigator</h2>
<p>Voir le <a
href="https://reactnavigation.org/docs/hello-react-navigation/">tutoriel</a>
ou la <a
href="https://reactnavigation.org/docs/navigation-prop">documentation</a></p>
<p>Création de l’objet pour la fenêtre de “Recherche”</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Navigation/Navigation.js</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { createAppContainer } <span class="im">from</span> <span class="st">&#39;react-navigation&#39;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { createStackNavigator } <span class="im">from</span> <span class="st">&#39;react-navigation-stack&#39;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> Search <span class="im">from</span> <span class="st">&#39;../Components/Search&#39;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> SearchStackNavigator <span class="op">=</span> <span class="fu">createStackNavigator</span>({</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">// le nom Search dans le StackNavigator n&#39;est pas forcément identique au nom du composant</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Search</span><span class="op">:</span> {</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">screen</span><span class="op">:</span> Search<span class="op">,</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">navigationOptions</span><span class="op">:</span> {</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>      <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Rechercher&#39;</span><span class="op">,</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> <span class="fu">createAppContainer</span>(SearchStackNavigator)</span></code></pre></div>
<p>Dans APP.js remplacer <code>&lt;Search/&gt;</code> par
<code>&lt;Navigation/&gt;</code> y compris la directive import</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">// App.js</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> Navigation <span class="im">from</span> <span class="st">&#39;./Navigation/Navigation&#39;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> <span class="kw">class</span> App <span class="kw">extends</span> React<span class="op">.</span><span class="at">Component</span> {</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>() {</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">&lt;</span>Navigation <span class="op">/&gt;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h2 id="créer-une-vue-filmdetail">Créer une vue FilmDetail</h2>
<div class="sourceCode" id="cb3"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Components/FilmDetail.js</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { <span class="bu">StyleSheet</span><span class="op">,</span> View<span class="op">,</span> <span class="bu">Text</span> } <span class="im">from</span> <span class="st">&#39;react-native&#39;</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> FilmDetail <span class="kw">extends</span> React<span class="op">.</span><span class="at">Component</span> {</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>() {</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>      <span class="op">&lt;</span>View style<span class="op">=</span>{styles<span class="op">.</span><span class="at">main_container</span>}<span class="op">&gt;</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;</span><span class="bu">Text</span><span class="op">&gt;</span>Détail du film<span class="op">&lt;/</span><span class="bu">Text</span><span class="op">&gt;</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>      <span class="op">&lt;/</span>View<span class="op">&gt;</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> styles <span class="op">=</span> <span class="bu">StyleSheet</span><span class="op">.</span><span class="fu">create</span>({</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">main_container</span><span class="op">:</span> {</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">flex</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> FilmDetail</span></code></pre></div>
<p>Ajout de la vue FilmDetail au StackNavigator</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> SearchStackNavigator <span class="op">=</span> <span class="fu">createStackNavigator</span>({</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// le nom dans le StackNavigator n&#39;est pas obligatoirement</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// identique au nom du Composant</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">FilmDetail</span><span class="op">:</span> {</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">screen</span><span class="op">:</span> FilmDetail</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Dans Component/Search.js ajouter une fonction prenant en charge le
click sur un film</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>_displayDetailForFilm <span class="op">=</span> (idFilm<span class="op">,</span> listId) <span class="kw">=&gt;</span> {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;film.id=&#39;</span> <span class="op">+</span> idFilm <span class="op">+</span> <span class="st">&#39; film.listId=&#39;</span> <span class="op">+</span> listId)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Cela paraît évident qu’il s’agit d’un clic sur un item (FilmItem) de
notre FlatList. On veut qu’au clic sur un component FilmItem, le détail
du film cliqué soit affiché. On va donc avoir besoin d’appeler la
fonction _displayDetailForFilm dans le component FilmItem.</p>
<p>Le composant Pressable permet de récupérer les événements de
click.</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { Pressable } <span class="im">from</span> <span class="st">&quot;react-native&quot;</span><span class="op">;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> FilmItem <span class="kw">extends</span> React<span class="op">.</span><span class="at">Component</span> {</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">render</span>() {</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> film <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">props</span><span class="op">.</span><span class="at">film</span><span class="op">;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>            <span class="op">&lt;</span>Pressable onPress<span class="op">=</span>{ () <span class="kw">=&gt;</span> <span class="fu">alert</span>(<span class="st">&quot;clicked&quot;</span>) } <span class="op">&gt;</span></span></code></pre></div>
<p>Véfifier que le <code>alert("clicked")</code> fonctionne
correctement</p>
<p>Gestion du clic sur le FilmItem :</p>
<ol type="1">
<li>On passe l’objet film en prop au FilmItem : <code>&lt;FilmItem
film={ item }</code></li>
<li>On passe la fonction _displayDetailForFilm en prop au FilmItem :
<code>displayDetailForFilm={ this._displayDetailForFilm }</code></li>
<li>On récupère les deux props par <a
href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment">décomposition
Javascript</a></li>
<li>Le FilmItem est <code>Pressable</code> (voir ci-dessus)</li>
<li>Au moment du clic sur un FilmItem on va utiliser la prop
<code>displayDetailForFilm</code>du FilmItem qui est défini dans le
composant <code>Search</code> pour traiter le clic et naviguer dans le
composant FilmDetail</li>
</ol>
<div class="sourceCode" id="cb7"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Components/Search.js</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>FlatList renderItem<span class="op">=</span>{ ({ item }) <span class="kw">=&gt;</span> <span class="op">&lt;</span>FilmItem film<span class="op">=</span>{ item } displayDetailForFilm<span class="op">=</span>{ <span class="kw">this</span><span class="op">.</span><span class="at">_displayDetailForFilm</span> } <span class="op">/&gt;</span> }</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Components/FilmItem.js</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> FilmItem <span class="kw">extends</span> React<span class="op">.</span><span class="at">Component</span> {</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>() {</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Récupération des props par décomposition Javascript</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>      <span class="co">// { film, displayDetailForFilm } = this.props</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>      <span class="co">// &#39;⟺     const film = this.props.film</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>      <span class="co">// &#39;       const displayDetailForFilm = this.props.displayDetailForFilm</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> { film<span class="op">,</span> displayDetailForFilm } <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">props</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>      <span class="co">// ...</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>      <span class="op">&lt;</span>Pressable onPress<span class="op">=</span>{ () <span class="kw">=&gt;</span> <span class="fu">displayDetailForFilm</span>(film<span class="op">.</span><span class="at">id</span><span class="op">,</span> film<span class="op">.</span><span class="at">listId</span>) } <span class="op">&gt;</span></span></code></pre></div>
<p>Constater dans le log que cela fonctionne</p>
<p>Comme on a ajouté <code>Search</code> et <code>FilmDetail</code> dans
le <code>StackNavigator</code><br> chaque composant a une
<code>prop</code> qui s’appelle <code>navigation</code><br> et qui nous
permet d’accéder à notre <code>StackNavigator</code>.</p>
<p>Maintenant on va ouvrir le FilmDetail grâce à la méthode
<code>navigate</code> (voir un <a
href="https://reactnavigation.org/docs/params">exemple</a> et/ou la <a
href="https://reactnavigation.org/docs/navigation-prop/#navigate">documentation</a>
du <code>StackNavigator</code>)<br> Avec la méthode
<code>navigate</code> on ajoute un paramètre <code>idFilm</code> à
passer à <code>FilmDetail</code></p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>_displayDetailForFilm <span class="op">=</span> (idFilm<span class="op">,</span> listId) <span class="kw">=&gt;</span> {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;film.id=&#39;</span> <span class="op">+</span> idFilm <span class="op">+</span> <span class="st">&#39; film.listId=&#39;</span> <span class="op">+</span> listId)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">this</span><span class="op">.</span><span class="at">props</span><span class="op">.</span><span class="at">navigation</span><span class="op">.</span><span class="fu">navigate</span>(<span class="st">&#39;FilmDetail&#39;</span><span class="op">,</span> { <span class="dt">idFilm</span><span class="op">:</span> idFilm })</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Vérifions comment cela se passe :</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> FilmDetail <span class="kw">extends</span> React<span class="op">.</span><span class="at">Component</span> {</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>() {</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="kw">this</span><span class="op">.</span><span class="at">props</span><span class="op">.</span><span class="at">navigation</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>      <span class="co">// ...</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>On constate que le idFilm se trouve dans
<code>this.props.navigation.state.params.idFilm</code><br> On peut
récupérer cette valeur via
<code>this.props.navigation.getParam('idFilm')</code></p>
