<!DOCTYPE html>
<html>
<head>
<title>05-Props et State.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="props-et-state">Props et State</h1>
<h2 id="props">Props</h2>
<p>On va reprendre notre bouton de recherche</p>
<pre class="hljs"><code><div><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Search</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
  render() {
    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{styles.main_container}</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">TextInput</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{styles.textinput}</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">'Titre du film'</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">title</span>=<span class="hljs-string">'Rechercher'</span> <span class="hljs-attr">onPress</span>=<span class="hljs-string">{()</span> =&gt;</span> {}}/&gt;
      <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span>
    )
  }
}
</div></code></pre>
<p>Le composant FlatList nous permet d'afficher une liste d'éléments
Le composant Text nous permet d'afficher du texte</p>
<pre class="hljs"><code><div><span class="hljs-keyword">import</span> { FlatList, Text } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-native'</span>
</div></code></pre>
<p>On créé un dictionnaire et on l'affiche dans la flatlist</p>
<pre class="hljs"><code><div>data={ [ {<span class="hljs-attr">key</span>: <span class="hljs-string">'a'</span>}, {<span class="hljs-attr">key</span>: <span class="hljs-string">'b'</span>}]}
</div></code></pre>
<p>L'attribut <code>renderItem</code> défini comment chaque élement de la liste doit être affiché.<br>
La boucle est &quot;automatique&quot;. On utilise uen fonction fléchée Javascript.</p>
<pre class="hljs"><code><div>renderItem={({item}) =&gt; <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Text</span>&gt;</span>{item.key}<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span></span>
    **est équivalent à**
renderItem={<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">{item}</span>) </span>{ <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Text</span>&gt;</span>{item.title}<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span></span> }}
</div></code></pre>
<pre class="hljs"><code><div>&lt;FlatList
    data={[{<span class="hljs-attr">key</span>: <span class="hljs-string">'a'</span>}, {<span class="hljs-attr">key</span>: <span class="hljs-string">'b'</span>}]}
    renderItem={({item}) =&gt; <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Text</span>&gt;</span>{item.key}<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span></span>}
/&gt;
</div></code></pre>
<p>**Par défaut FlatList a sont sytlés <code>flex: 1</code> et pour changer cela il faut l'encapsuler dans une <code>&lt;View&gt;</code></p>
<p>Maintenant pour avoir une liste de films</p>
<ul>
<li>Créons un dossier Helpers</li>
<li>Mettons-y un fichier filmsData.js*</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-comment">// Helpers/filmsData.js</span>

<span class="hljs-keyword">let</span> films = [
    {
        <span class="hljs-attr">id</span>: <span class="hljs-number">181808</span>,
        <span class="hljs-attr">vote_average</span>: <span class="hljs-number">7.2</span>,
        <span class="hljs-attr">title</span>: <span class="hljs-string">"Star Wars VIII - Les derniers Jedi"</span>,
        <span class="hljs-attr">poster_path</span>: <span class="hljs-string">""</span>,
        <span class="hljs-attr">original_title</span>: <span class="hljs-string">"Star Wars: The Last Jedi"</span>,
        <span class="hljs-attr">overview</span>: <span class="hljs-string">"Nouvel épisode de la saga. Les héros du Réveil de la force rejoignent les figures légendaires de la galaxie dans une aventure épique qui révèle des secrets ancestraux sur la Force et entraîne de choquantes révélations sur le passé…"</span>,
        <span class="hljs-attr">release_date</span>: <span class="hljs-string">"2017-12-13"</span>
    },
    {
        <span class="hljs-attr">id</span>: <span class="hljs-number">181809</span>,
        <span class="hljs-attr">vote_average</span>: <span class="hljs-number">8.1</span>,
        <span class="hljs-attr">title</span>: <span class="hljs-string">"La Guerre des étoiles"</span>,
        <span class="hljs-attr">poster_path</span>: <span class="hljs-string">""</span>,
        <span class="hljs-attr">original_title</span>: <span class="hljs-string">"Star Wars"</span>,
        <span class="hljs-attr">overview</span>: <span class="hljs-string">"Il y a bien longtemps, dans une galaxie très lointaine... La guerre civile fait rage entre l'Empire galactique et l'Alliance rebelle. Capturée par les troupes de choc de l'Empereur menées par le sombre et impitoyable Dark Vador, la princesse Leia Organa dissimule les plans de l’Étoile Noire, une station spatiale invulnérable, à son droïde R2-D2 avec pour mission de les remettre au Jedi Obi-Wan Kenobi. Accompagné de son fidèle compagnon, le droïde de protocole C-3PO, R2-D2 s'échoue sur la planète Tatooine et termine sa quête chez le jeune Luke Skywalker. Rêvant de devenir pilote mais confiné aux travaux de la ferme, ce dernier se lance à la recherche de ce mystérieux Obi-Wan Kenobi, devenu ermite au cœur des montagnes désertiques de Tatooine..."</span>,
        <span class="hljs-attr">release_date</span>: <span class="hljs-string">"1977-05-25"</span>
    }
]

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> films
</div></code></pre>
<p>Dans Search.js</p>
<ul>
<li>Importer le filmsData</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-keyword">import</span> films <span class="hljs-keyword">from</span> <span class="hljs-string">'../Helpers/filmsData'</span>
</div></code></pre>
<ul>
<li>Affiner la méthode renterItem</li>
</ul>
<pre class="hljs"><code><div>&lt;FlatList
  data={films}
  renderItem={({item}) =&gt; <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Text</span>&gt;</span>{item.title}<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span></span>}
/&gt;
</div></code></pre>
<ul>
<li>Préciser quel champ utiliser pour la clé, si on n'a pas un champ key de type String</li>
</ul>
<pre class="hljs"><code><div>keyExtractor={(item) =&gt; item.id.toString()}
</div></code></pre>
<p>A faire : dans la liste, à la place du <code>&lt;Text&gt;</code> créer un style pour afficher les films
<img src="unfilm.jpg" alt="image info"></p>
<p><img src="unfilmsketch.png" alt="image info"></p>
<p>&lt;FlatList
data={films}
renderItem={({item}) =&gt; <FilmItem film={item}/>}
/&gt;</p>
<h1 id="props">Props</h1>
<p>En React Native les propriétés d'un composant s'appellent les <strong>props</strong> comme l'attribut <code>style</code>
Voir par exemple les <a href="https://reactnative.dev/docs/text#props">props du composant Text</a></p>
<p>On peut ajouter notre prop <code>firstLetterColor={{color:'red'}}</code>. Pour l'instant cette Prop n'existe pas dans le composant Text mais on peut l'ajouter.</p>
<p>Vérifier dans FilmItem</p>
<pre class="hljs"><code><div>    render() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.props.film.title)


<span class="hljs-comment">/*
comme si on avait

  class FilmItem {
      var film;
  }
  var filmItem = new FilmItem();
  filmItem.film = item;
*/</span>
</div></code></pre>
<pre class="hljs"><code><div><span class="hljs-comment">// FilmItem</span>
    render() {
        <span class="hljs-keyword">const</span> film = <span class="hljs-keyword">this</span>.props.film
        ...
                &lt;Image
                    style={styles.image}
                    source={{
                        <span class="hljs-attr">uri</span>: <span class="hljs-string">'https://reactnative.dev/img/tiny_logo.png'</span>,
                    }}
                /&gt;
</div></code></pre>
<h2 id="state">State</h2>
<h3 id="api-tndb">API TNDB</h3>
<p>L'API TMDB (The Movie DataBase) <a href="https://www.themoviedb.org/documentation/api?language=fr">documentation</a> permet de récupérer des informations sur les films en français. Il faut <a href="https://www.themoviedb.org/account/signup?language=fr">créer un compte</a> en chosissant l'option <code>Développeur</code> (et non pas <s>professionnel</s>).</p>
<p><strong>ATTENTION Prenez bien le token dans &quot;Clé de l'API (v3 auth)&quot;. Ne faites pas l'erreur de prendre &quot;Jeton d'accès en lecture à l'API (v4 auth)&quot;.</strong></p>
<ul>
<li>S'inscrire</li>
<li>Récupérer l'API_TOKEN</li>
<li><a href="https://developers.themoviedb.org/3/getting-started/search-and-query-for-details">Documentation recherche</a></li>
</ul>
<h3 id="installation-et-documentation-axios">Installation et documentation AXIOS</h3>
<ul>
<li>Installer axios <code>yarn add axios</code></li>
<li>Exemple de requête API avec AXIOS :</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;
<span class="hljs-keyword">const</span> baseUrl = <span class="hljs-string">'https://reqres.in'</span>;

<span class="hljs-comment">// Passing configuration object to axios</span>
<span class="hljs-keyword">const</span> fetchUser = <span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">const</span> configurationObject = {
    <span class="hljs-attr">method</span>: <span class="hljs-string">'get'</span>,
    <span class="hljs-attr">url</span>: <span class="hljs-string">`<span class="hljs-subst">${baseUrl}</span>/api/users/1`</span>,
  };
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios(configurationObject);
  <span class="hljs-built_in">console</span>.log(response.data);
};

<span class="hljs-comment">// Invoking get method to perform a GET request</span>
<span class="hljs-keyword">const</span> fetchUser = <span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">const</span> url = <span class="hljs-string">`<span class="hljs-subst">${baseUrl}</span>/api/users/1`</span>;
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.get(url);
  <span class="hljs-built_in">console</span>.log(response.data);
};
</div></code></pre>
<p>Créer une instance axios</p>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> axiosInstance = axios.create({ <span class="hljs-attr">baseURL</span>: <span class="hljs-string">'https://reqres.in/'</span> });

axiosInstance.get(<span class="hljs-string">'api/users/1'</span>).then(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> {
  <span class="hljs-built_in">console</span>.log(response.data);
});
</div></code></pre>
<p><a href="https://blog.logrocket.com/using-axios-react-native-manage-api-requests/">Une documentation AXIOS et React Native</a></p>
<h3 id="ecrire-le-code-pour-lappel-api">Ecrire le code pour l'appel API</h3>
<ul>
<li>Créer un dossier API</li>
<li>Créer un fichier API/TMDBApi.js</li>
</ul>
<p>TMDBApi.js : fonction et URL pour l'appel API</p>
<pre class="hljs"><code><div><span class="hljs-comment">// API/TMDBApi.js</span>
<span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;

<span class="hljs-keyword">const</span> API_TOKEN = <span class="hljs-string">"VOTRE_TOKEN_ICI"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getFilmsFromApiWithSearchedText</span> = <span class="hljs-title">async</span> (<span class="hljs-params">text</span>) =&gt; </span>{
  <span class="hljs-keyword">const</span> url = <span class="hljs-string">'https://api.themoviedb.org/3/search/movie?api_key='</span> + API_TOKEN + <span class="hljs-string">'&amp;language=fr&amp;query='</span> + text
  
}
</div></code></pre>
<p>TMDBApi.js : fonction getFilmsFromApiWithSearchedText complète, avec log et export</p>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> getFilmsFromApiWithSearchedText = <span class="hljs-keyword">async</span> (text) =&gt; {
  <span class="hljs-keyword">const</span> url = <span class="hljs-string">'https://api.themoviedb.org/3/search/movie?api_key='</span> + API_TOKEN + <span class="hljs-string">'&amp;language=fr&amp;query='</span> + text
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.get(url);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'--getFilmsFromApiWithSearchedText--'</span>)
  <span class="hljs-built_in">console</span>.log(response.data);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'--fin getFilmsFromApiWithSearchedText--'</span>)
  <span class="hljs-keyword">return</span> response.data;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> getFilmsFromApiWithSearchedText;
</div></code></pre>
<p>Composant Search : ajout de la fonction _loadFilms</p>
<pre class="hljs"><code><div><span class="hljs-comment">// Fonction _loadFilms qui effectue l'appel API</span>
<span class="hljs-comment">// Vérification avec console.log</span>
<span class="hljs-comment">//     data est un objet Javascript</span>
<span class="hljs-comment">//     data.results est un tableau Javascript avec les films</span>
_loadFilms() {
    getFilmsFromApiWithSearchedText(<span class="hljs-string">"star"</span>).then(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> 
      <span class="hljs-built_in">console</span>.log(
        <span class="hljs-string">'--_loadFilms\n'</span> + <span class="hljs-built_in">JSON</span>.stringify(data)+ <span class="hljs-string">'\n_loadFilms--'</span>
        + data.results[<span class="hljs-number">0</span>].original_title + <span class="hljs-string">'\n--_loadFilms--'</span>
        
        ));
}
<span class="hljs-comment">// ...</span>

<span class="hljs-comment">// Activation de l'événement onPress</span>
&lt;Button title=<span class="hljs-string">'Rechercher'</span> onPress={() =&gt; <span class="hljs-keyword">this</span>._loadFilms()}/&gt;
</div></code></pre>
<p>Composant Search : création de la liste de films au niveau de la classe</p>
<pre class="hljs"><code><div><span class="hljs-comment">// Components/Search.js</span>
<span class="hljs-comment">// commenter import films from '../Helpers/filmsData'</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Search</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{

  <span class="hljs-comment">// ajouter la prop films, une liste vide au départ</span>
  <span class="hljs-keyword">constructor</span>(props) {
    <span class="hljs-keyword">super</span>(props)
    <span class="hljs-keyword">this</span>._films = []      <span class="hljs-comment">// ceci va devenir un state</span>
  }
  
  <span class="hljs-comment">//...</span>
  _loadFilms() {
    getFilmsFromApiWithSearchedText(<span class="hljs-string">"star"</span>).then(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
      <span class="hljs-keyword">this</span>._films = data.results;
      <span class="hljs-keyword">this</span>.forceUpdate();
    });
  }

  <span class="hljs-comment">// la flatlist affiche la prop</span>
  &lt;FlatList
    data={<span class="hljs-keyword">this</span>._films}

  <span class="hljs-comment">//...</span>
}
</div></code></pre>
<h2 id="diff%C3%A9rence-entre-prop-et-state">Différence entre prop et state</h2>
<p><strong>Les props (que l'on a déjà vues) sont fixées par le component parent et ne peuvent pas être modifiées par le component qui les reçoit.</strong> Le component parent peut les changer.</p>
<p><strong>Dès lors que vous souhaitez modifier votre component et ses données affichées, vous allez utiliser son state.</strong></p>
<p>Ci-dessous :</p>
<ul>
<li>films fait partie du State du composant</li>
<li>avec setState on change l'état du State et on actualise l'interface</li>
<li>seuls les changements nécessaires sont effectués</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-keyword">constructor</span>(props) {
    <span class="hljs-keyword">super</span>(props)
    <span class="hljs-comment">// films est dans le state : l'interface sera actualisée à chaque appel de setState</span>
    <span class="hljs-keyword">this</span>.state = { <span class="hljs-attr">films</span>: [] }
}
<span class="hljs-comment">// ...</span>
render()
<span class="hljs-comment">//..</span>
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"RENDER"</span>)
  <span class="hljs-keyword">return</span> <span class="hljs-comment">//...</span>
  <span class="hljs-comment">//...</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">FlatList</span>
  // <span class="hljs-attr">les</span> <span class="hljs-attr">donn</span>é<span class="hljs-attr">es</span> <span class="hljs-attr">de</span> <span class="hljs-attr">la</span> <span class="hljs-attr">FlatList</span> <span class="hljs-attr">doivent</span> ê<span class="hljs-attr">tre</span> <span class="hljs-attr">actualis</span>é<span class="hljs-attr">es</span> à <span class="hljs-attr">chaque</span> <span class="hljs-attr">appel</span> <span class="hljs-attr">de</span> <span class="hljs-attr">setState</span>
  <span class="hljs-attr">data</span>=<span class="hljs-string">{this.state.films}</span>

//<span class="hljs-attr">...</span>

<span class="hljs-attr">_loadFilms</span>() {
    <span class="hljs-attr">getFilmsFromApiWithSearchedText</span>("<span class="hljs-attr">star</span>")<span class="hljs-attr">.then</span>(<span class="hljs-attr">data</span> =&gt;</span> {
        // appel de setSate, actualistion automatique de la Flatlist
        this.setState({ films: data.results })
        // enlever le forceUpdate()
    })
}

</span></div></code></pre>
<p>Optimisation de la recherche : événement onChangeText</p>
<pre class="hljs"><code><div><span class="hljs-comment">// Dans le constructeur</span>
<span class="hljs-keyword">this</span>.searchedText = <span class="hljs-string">''</span>

<span class="hljs-comment">// Nouvelle méthode</span>
  _searchTextInputChanged(text) {
    <span class="hljs-keyword">this</span>.searchedText = text <span class="hljs-comment">// Modification du texte recherché à chaque saisie de texte, sans passer par setState</span>
  }

<span class="hljs-comment">// Au niveau du TextInput</span>
  &lt;TextInput
    placeholder=<span class="hljs-string">"Titre du film"</span>
    style={{ styles }}
    onChangeText={(text) =&gt; <span class="hljs-keyword">this</span>._searchTextInputChanged(text)}
  /&gt;
</div></code></pre>
<p>Cela fonctionne bien si on clique sur 'Rechercher'.<br>
Cela ne fonctionne pas si on appuie sur Entrée<br>
Regarder la documentation sur TextInput et trouver comment faire pour que cela fonctionne aussi
en appuyant sur la touche Entrée.</p>
<p>Fichier Search.js complet (sans la touche entrée)</p>
<pre class="hljs"><code><div><span class="hljs-comment">// Components/Search.js</span>

<span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>
<span class="hljs-keyword">import</span> { StyleSheet, View, TextInput, Button, Text, FlatList } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-native'</span>
<span class="hljs-keyword">import</span> FilmItem <span class="hljs-keyword">from</span> <span class="hljs-string">'./FilmItem'</span>
<span class="hljs-keyword">import</span> { getFilmsFromApiWithSearchedText } <span class="hljs-keyword">from</span> <span class="hljs-string">'../API/TMDBApi'</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Search</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{

  <span class="hljs-keyword">constructor</span>(props) {
    <span class="hljs-keyword">super</span>(props)
    <span class="hljs-keyword">this</span>.searchedText = <span class="hljs-string">''</span> <span class="hljs-comment">// Initialisation de notre donnée searchedText en dehors du state</span>
    <span class="hljs-keyword">this</span>.state = {
      <span class="hljs-attr">films</span>: []
    }
  }

  _loadFilms() {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.searchedText.length &gt; <span class="hljs-number">0</span>) { <span class="hljs-comment">// Seulement si le texte recherché n'est pas vide</span>
      getFilmsFromApiWithSearchedText(<span class="hljs-keyword">this</span>.searchedText).then(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
          <span class="hljs-keyword">this</span>.setState({ <span class="hljs-attr">films</span>: data.results })
      })
    }
  }

  _searchTextInputChanged(text) {
    <span class="hljs-keyword">this</span>.searchedText = text <span class="hljs-comment">// Modification du texte recherché à chaque saisie de texte, sans passer par setState</span>
  }

  render() {
    <span class="hljs-comment">//console.log("RENDER")</span>
    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{styles.main_container}</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">TextInput</span>
          <span class="hljs-attr">style</span>=<span class="hljs-string">{styles.textinput}</span>
          <span class="hljs-attr">placeholder</span>=<span class="hljs-string">'Titre du film'</span>
          <span class="hljs-attr">onChangeText</span>=<span class="hljs-string">{(text)</span> =&gt;</span> this._searchTextInputChanged(text)}
        /&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">title</span>=<span class="hljs-string">'Rechercher'</span> <span class="hljs-attr">onPress</span>=<span class="hljs-string">{()</span> =&gt;</span> this._loadFilms()}/&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">FlatList</span>
          <span class="hljs-attr">data</span>=<span class="hljs-string">{this.state.films}</span>
          <span class="hljs-attr">keyExtractor</span>=<span class="hljs-string">{(item)</span> =&gt;</span> item.id.toString()}
          renderItem={({item}) =&gt; <span class="hljs-tag">&lt;<span class="hljs-name">FilmItem</span> <span class="hljs-attr">film</span>=<span class="hljs-string">{item}/</span>&gt;</span>}
        /&gt;
      <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span>
    )
  }
}

<span class="hljs-keyword">const</span> styles = StyleSheet.create({
  <span class="hljs-attr">main_container</span>: {
    <span class="hljs-attr">flex</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">marginTop</span>: <span class="hljs-number">20</span>
  },
  <span class="hljs-attr">textinput</span>: {
    <span class="hljs-attr">marginLeft</span>: <span class="hljs-number">5</span>,
    <span class="hljs-attr">marginRight</span>: <span class="hljs-number">5</span>,
    <span class="hljs-attr">height</span>: <span class="hljs-number">50</span>,
    <span class="hljs-attr">borderColor</span>: <span class="hljs-string">'#000000'</span>,
    <span class="hljs-attr">borderWidth</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">paddingLeft</span>: <span class="hljs-number">5</span>
  }
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Search
</div></code></pre>

</body>
</html>
